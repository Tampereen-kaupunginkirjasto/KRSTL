<!DOCTYPE>
<html lang="fi">
	<head>
		<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<title>Kirjareitti, vaatii Javascriptin</title>
		<script>
var oldHash = ""
var vastaukset
var otsikot = [
	{
		otsikko: "Esimerkkiotsikko",
		"lomakkeet": [
			{
				lomake: "Esimerkkikysymyssarja A",
				otsikko: "Esimerkkitehtäviä alakoululaisille<br>Kysymyssarja A",
				/* HUOM llid:n on oltava uniikki tunniste yksittäiselle lomakkeelle. Sitä käytetään linkeissä ja lomakkeen osoitteessa */
				llid: "ak_a",
				"kysymykset": [
					{
						kysymys: "Merja ja Marvi Jalo supersuositun kirjasarjan pääosassa on koira. Mikä on koiran nimi?",
						vastaus: /^\s*Jesse\s*$/i
					},
					{
						kysymys: "Kuka on kirjoittanut kirjan Rakastunut krokotiili?",
						vastaus: /^\s*(Hannu\s+Hirvonen|Hirvo[sn]en\,?\s+Hannu)\s*$/i
					},
					{
						kysymys: "Anneli Kanto on kirjoittanut kirjasarjan FC Tytsyt -jalkapallojoukkueesta. Sarjaan kuuluu myös kirja Pusu ja pokaali. Mikä on kirjasarjan nimi?",
						vastaus: /^\s*Futistytt[öo]\s*$/i
					},
					{
						kysymys: "Väinämö Kontiainen seikkailee Katri Tapolan kirjoittamissa kirjoissa. Mitä urheilulajia hän harrastaa kirjassa Väinämö sisäkentillä?",
						vastaus: /^\s*Koripallo[a]?\s*$/i
					},
					{
						kysymys: "Mistä aiheesta kertovia kirjoja kuuluu luokkaan 55.4?",
						vastaus: /^\s*Dinosauruks(et|ista)\s*$/i
					},
					{
						kysymys: 'Minkä värinen kansi on Måns Gahrtonin kirjoittamassa kirjassa "Eva ja Adam Ensi silmäyksellä"?',
						vastaus: /^\s*Vihre[äa]\s*$/i
					},
				]
			},
			{
				lomake: "Esimerkkikysymyssarja B",
				otsikko: "Esimerkkitehtäviä alakoululaisille<br>Kysymyssarja B",
				llid: "ak_b",
				"kysymykset": [
					{
						"kysymys": "Suorapuheinen poikatyttö Venla muuttaa uudelle paikkakunnalle ja uuteen kouluun Katariina Romppaisen kirjassa. Mikä on kirjan nimi?",
						"vastaus": /^\s*Roolipeliä\s*$/i
					},
					{
						"kysymys": "Kirja myrkytetyn mutakakun tapaus kuuluu Mysteeritytöt-sarjaan. Kuka on kirjoittanut sarjan kirjat?",
						"vastaus": /^\s*(Alex\s+Carter|Carter\,?\s+Alex)\s*$/i
					},
					{
						"kysymys": "Kirjassa Päivän Harri kymmenvuotias Tiia asuu kahden isänsä kanssa. Luokkakaveri Harri on ärsyttävä, hankala ja hölmö. Tiiasta on ihmeellistä, että hän silti tykkää Harrista. Kuka kirjan on kirjoittanut?",
						"vastaus": /^\s*(Alakoski\,?\s+Susanna|Susanna\s+Alakoski)\s*$/i
					},
					{
						"kysymys": "Katso OUTI-verkkokirjastosta, kuinka monta sivua on kirjassa Varjonaamio?",
						"vastaus": /^\s*(256|kaksisataaviisikymmentäkuusi?)\s*$/i
					},
					{
						"kysymys": "Kirja Jääkarhun apuna aloittaa sarjan, jonka pääosassa seikkailee Ella. Mikä on tämän Skye Watersin kirjoittaman sarjan nimi?",
						"vastaus": /^\s*Taikakoirat\s*$/i
					},
					{
						"kysymys": "Harri ja dinot melovat seikkailuun kirjassa Harri joutuu ystäviensä kanssa melkoiseen seikkailuun. Minkä värinen mela Harrilla on kädessään kirjan kannessa?",
						"vastaus": /^\s*punainen\s*$/i
					},
				]
			},
		]
	},
	{
		"otsikko": "Toinen esimerkkiotsikko",
		"lomakkeet": [
			{
				"lomake": "Esimerkkikysymyssarja A",
				otsikko: "Esimerkkitehtäviä yläkoululaisille<br>Kysymyssarja A",
				llid: "yk_a",
				"kysymykset": [
					{
						"kysymys": "Kirjassa Niskaan putoava taivas 14-vuotias Tekla saa viettää viikon ilman vanhempiaan, mutta unelmaviikosta tuleekin painajainen. Kuka kirjan on kirjoittanut?",
						"vastaus": /^\s*(Laura\s+L[äa]hteenm[äa]ki|Lähteenmä(en|ki)\,?\s+Laura)\s*$/i
					},
					{
						"kysymys": "Kuka on suomentanut Stephenie Meyerin kirjan Epäilys?",
						"vastaus": /^\s*(Pirkko\s+Bistr[oö]m|Bistr[oö]m(in)?\,?\s+Pirkko)\s*$/i
					},
					{
						"kysymys": "Lauren Conrad on kirjoittanut herkullisen viihdyttävän romaanin Hollywoodin kulissien takaa. Mikä on Suolaista ja makeaa -kirjan alkuperäinen englanninkielinen nimi?",
						"vastaus": /^\s*Sugar\s+and\s+spice\s*$/i
					},
					{
						"kysymys": "Sari Peltoniemen kirja Haltijan poika ammentaa aineksia kauhutarinoista ja kolttasaamelaisesta perinteestä. Mille teokselle se on jatkoa?",
						"vastaus": /^\s*Kuulen\s+kutsun\s+mets[aä]npeittoon\s*$/i
					},
					{
						"kysymys": "Mikä on Outi Pyyn muotia, ompelua ja tuunausta käsittelevän Trashion-kirjan hyllypaikka?",
						"vastaus": /^\s*67[,.]42\s+PYY\s*$/i
					},
					{
						"kysymys": "Jacinda on draki, lohikäärmeistä polveutuva ihminen. Hän joutuu jättämään heimonsa ja aloittamaan uuden elämän ihmisten parissa. Sophie Jordanin Liekki-kirjan kannessa on Jacindan kuva. Minkä väriset hiukset hänellä on?",
						"vastaus": /^\s*Punai(nen|set)\s*$/i
					},
				]
			},
		]
	},
]
</script>
<style type="text/css">
body {
	font-family: Arial, Helvetica, sans-serif;
	color:#262626;
}

div#koepaikka {
	margin: 0;
	padding: 0;
}

img.alkukuva, img.loppukuva {
	display: block;
	margin-left: auto;
	margin-right: auto;
}

img.alkukuva {
	padding-top: 5px;
	margin-top: 5px;
	padding-bottom: 5px;
	margin-bottom: 5px;
}
img.loppukuva {
	padding-top: 10px;
	margin-top: 10px;
	padding-bottom: 5px;
	margin-bottom: 5px;
}

h1, h1+h2, p.alaotsake {
	text-align:center;
}

div#ohje { display:none;}

div.ohje {
	margin-bottom:20;
	padding-bottom:20px;
}
div, div.ohje, div.boksi, div.oikea, div.vaara, h1, h1+h2 {
	border-radius:7px;
	margin-top:5px;
	padding-bottom:5px;
	padding-top:5px;
	padding-right:5px;
	padding-left:5px;
	width:auto;
}

div.ohje h2 {
	display: block;
	margin-top:5px;
	margin-bottom: 0px;
	padding-top:5px;
	padding-bottom: 0px;
	margin-left:5px;

}

h1, div.footer {
	margin-top:20px;
	background: #FE642E;
	border: 2px solid #DE2E87;
}

h1 { color: white;}

div.footer {
	color: black;
	display: block;
	text-align: center;
	font-size:80%;
}

div.boksi {
	background: yellow;
	border: 2px solid #FDD267;
}

div.oikea, div.ohje , h1+h2{
	background: #BEF781;
	border: 2px solid #A2C75F;
}

div.vaara {
	background:red;
	border: 2px solid #E95F40;
}

input[type='text'] {
	padding: 5px;
	font-size: 12px;
	outline: none;
	background: -webkit-gradient(linear, left top, left bottom, from(#dddddd), to(#ffffff));
	background: -moz-linear-gradient(top,  #dddddd,  #ffffff);
	-webkit-border-radius: 3px;
	-moz-border-radius: 3px;
	border-radius: 3px;
	border: 1px solid #717171;
	-webkit-box-shadow: 1px 1px 0px #efefef;
	-moz-box-shadow: 1px 1px 0px #efefef;
	box-shadow:  1px 1px 0px #efefef;
}
</style>
<script>
/* Alapuolinen vastaavaan merkintään asti leikattu ja liimattu siistimättä ja sellaisenaan aiemmasta versiosta */

var DEBUG = false;
var DEBUGStr;
if (DEBUGStr == undefined) { 
	if (DEBUG) DEBUGStr = "Tähän kertyy debuggi\n";
	else DEBUGStr ="Debug pois käytöstä";
}

function DBS(str) {
	/* Apufunktio, jolla debuggia kerätään. Syö parametrina tekstiä, tai jotain
	mikä on automaattisesti muutettavissa tekstiksi. Palauttaa saamansa asian
	sellaisenaan, jotta tätä voi kutsua vaikkapa alert(DBS("foo")); -muodossa.
	
	Ei kerää saamaansa talteen, jos globaali muuttuja DEBUG on false; */
	if (DEBUG) {
		DEBUGStr += "" + str + "\n";
		/* IE:ssä console-olio on olemassa vasta devikilkkeiden käynnistämisen jälkeen tabikohtaisesti */
		if (typeof console != "undefined") {
			console.log(str);
		}
	}
	return str;
}

function naytaDebug(obj) {
	/* Apufunktio, jolta käytetään kerätyn debug-tiedon näyttämiseen */
	/* BETTERME vois poistaa tai korvata paremmalla, tuotannossa tarpeeton */
	try {
		var elem;
		elem = document.getElementById("debugTahan");
		if (elem != null) {
			elem.innerHTML=DEBUGStr;
		} else {
			var str;
			str = "Debugin paikka kadoksissa, tätä ei pitäisi tapahtua, mutta jostain syystä kuitenkin tapahtui. Pahoittelut, mutta tässä debug kuitenkin näytille:\n" + DEBUGStr
			alert(str);
		}
	} catch (err) {
		alert("errori: " + err);
	}
	return false;
}

function verifioi_ja_anna_palaute(some_obj_in_form) {
	/* Tämä funktio hoitaa käyttäjän antamaan syötteen tarkastamisen ja
	palautteen antamisen käyttäjälle. Voidaan kutsua mistä kohtaa formia vain.
	Tunnistaa formin saamansa argumentin perusteella, joten this on kutsuessa luonteva.

	Palauttaa aina submitin ja siten reloadin estävän falsen */

	/*
	1. tarkistetaan, ollaanko form-elementissä, jos ei, etsitään se
	2. BETTERME huomioi, form-elementistön juuri voi olla joko sisarus tai matkalla
	kohti juurta joko suoraan tai sisaruksena. Em. ongelma ei esiinny nykyisellä
	html:llä, mutta ratkaisu ei toimi yleisesti. Huomioi myös, että vain yksi inputti
	per formi toimii. Käynnistys buttonilla */
	var formElementti;
	DBS("Aloitetaan formin etsintä");
	try {
		formElementti = haeYmparoiva("FORM", some_obj_in_form);
		DBS("Haettu formi löytyi");
	} catch (err) {
		alert(DBS("Formin etsintä meni pieleen:\"" + err + "\""));
	}

	DBS("Aloitetaan kysymyksen numeron etsintä, jotta löydetään oikea vastaus");
	var numero;
	try {
		numero = haeKysymyksenNumero(formElementti);
	} catch (err) {
		alert(DBS("Kysymyksen numeron haussa jotain pieleen: " + err));
		return false;
	}
	DBS("Formin numeron etsintä suoritettu. Numero on " + numero);

	/* Toivu ja ilmoita, jos vastaus puuttuu */
	if (!onkoOikeaVastausSaatavilla(numero)) return false;
	
	DBS("Haetaan ehdotettu vastaus");
	var inputStr;
	try { inputStr = kayttajanInputti(formElementti); }
	catch (err) {
		alert(DBS("Ehdotetun vastauksen haku epäonnistui: " + err));
		return false;
	}

	DBS("Haetaan se div, jolla palaute viestitään");
	try {
		divvi = haeYmparoiva("DIV",formElementti);
		DBS("Löytyi");
	} catch (err) {
		alert(DBS("Ei löydy: " + err));
		return false;
	}

	/* annetun vastauksen tarkistus ja palautteen anto */
	if (inputStr.length == 0) {
		DBS("Tyhjä vastaus");
		divvi.className = "boksi";
	} else if (vastaukset[numero].test(inputStr)) {
		divvi.className = "oikea";
		DBS("Oikein");
		try {
			if (divvi.getElementsByTagName("button").length != 1) throw "Nappien määrä";
			divvi.getElementsByTagName("button")[0].disabled = true;
			if (divvi.getElementsByTagName("input").length != 1) throw "inputtien määrä";
			divvi.getElementsByTagName("input")[0].disabled = true;
		} catch (err) {
			alert(DBS("Disabloinnissa ongelma: " + err));
		}
	} else {
		DBS("Väärä");
		divvi.className = "vaara";
	}
	DBS("palautetaan submitin ja reloadin estävä false");
	return false;
}



function kayttajanInputti(formElementti) {
	/* Apufunktio, joka hakee ja palauttaa käyttäjän syötteen formin ainoasta inputista.
	Ongelmista heitetään poikkeusta ja ilmoitetaan alertein ja lokiin */
	var inputStr;
	if (formElementti.getElementsByTagName("input").length != 1) {
		alert(DBS("Väärä määrä inputteja"));
		throw "Väärä määrä inputteja";
	}
	input = formElementti.getElementsByTagName("input")[0];
	if (input.getAttribute("type")!="text") {
		alert(DBS("Inputin tyyppi väärä"));
		throw "Inputin tyyppi väärä";
	}

	try {
		DBS("Haetaan syöte");
		inputStr = formElementti.getElementsByTagName("input")[0].value;
		if (typeof inputStr != "string") throw "Ei stringiä syötteenä";
	} catch (err) {
		alert(DBS("Vika syötteen haussa: " + err));
		throw "Vika syötteen haussa";
	}	
	return inputStr;
}


function onkoOikeaVastausSaatavilla(numero) {
	/* Apufunktio, jonka avulla varmistetaan oikean vastauksen olemassaolo */
	if (vastaukset == undefined) {
		alert(DBS("vastaukset kadoksissa"));
		return false;
	}
	if (vastaukset && vastaukset[numero] == undefined) {
		alert(DBS("Vastaus numerolla " + numero + " puuttuu!!!"));
		return false;
	}
	return true;
}


function haeYmparoiva(haettava, mistaHaetaan) {
/* Apufunktio, joka ottaa parametreina tyypin, mitä haetaan ja DOM-noden, mistä
ylöspäin puuta aletaan hakea. Huomioi, että haku suntautuu vain puussa suoraan ylöspäin.
Ilmoittaa virhetilanteista heittämällä poikkeuksen
*/
	DBS("haeYmparoiva: parametrien tarkastus");
	
	// parametrien tarkastukset
	if (haettava == undefined
			|| haettava == null
			|| haettava == ""
			|| typeof haettava != 'string'
			|| mistaHaetaan == undefined
			|| mistaHaetaan == null
			|| typeof mistaHaetaan != 'object'
			|| typeof mistaHaetaan.nodeName == "undefined") {
		throw "vikaa parametreissa";
	}
	
	DBS("Parametrit kunnossa. Haku alkaa. Haettava: " + haettava +", mistaHaetaan: " + mistaHaetaan +".");
	
	var i=1;
	while (mistaHaetaan.nodeName != haettava) {
		if (mistaHaetaan.nodeName == "HTML") throw "porattiin html-tagiin asti, ei löytynyt";
		if (mistaHaetaan.parentNode == undefined) throw "parentNode puuttuu.";
		mistaHaetaan = mistaHaetaan.parentNode;
		DBS("Hakukierros " + i + " suoritettu. Ei löytynyt. mistaHaetaan: " + mistaHaetaan);
		i++;
	}
	DBS("Löytyi");	
	return mistaHaetaan;
}

function haeKysymyksenNumero(formObj) {
	/* Etsii kysymyksen numeron oikeaa vastausta varten. Epäonnistumisesta lentää virhe */
	
	DBS("haeKysymyksenNumero() alkaa");
	var i;
	var formElement;
	for (i=0; formElement = document.getElementsByTagName("form")[i]; i++) {
		DBS("Verrataan " + i);
		if (formObj == formElement) {
			DBS("Löytyi: " + i + ".");
			return i;
		}
	}
	DBS("Etsittyä ei löytynyt!!!");
	throw "Etsittyä ei löytynyt!!!";
}

/* Yläpuolinen vastaavaan merkkiin asti leikattu ja liimattu
siistimättä ja sellaisenaan aiemmasta versiosta */

/* stubit erilaisille html-koodin pätkille */
var indexStubs = {
	title: "Esimerkkitehätäviä",
	otsikko: "Esimerkkitehtäviä",
}
var formStub = '<form onSubmit="return verifioi_ja_anna_palaute(this);">\
<input type="text" onBlur="verifioi_ja_anna_palaute(this);" />\
<button type="submit">Tarkista</button></form>'
/* stubit päättyy */

function queryVars() {
/* palauttaa:
0, jos on tarkoitus näyttää lista lomakkeista
viitteen lomakkeeseen, jos on tarkoitus näyttää lomake
korjaa osoitekentän ja latauttaa listan, jos hashiä ei tunnisteta */
	
	// napataan urlista hash-str ilman #-merkkiä
	var queryHash = window.location.hash.substring(1)
	var lomake
	if (queryHash.length == 0) { return 0 }
	else {
		lomake = loytyykoLomake(queryHash)
		if ( lomake != false) {
			// viitattu lomake löytyy
			return lomake
		}
		// hashissa jotain häröä, toivutaan
		window.location.hash=""
		return 0
	}
}

function kont() {
	oldHash = window.location.hash
	var action = queryVars()
	if (action==0) {
		naytaIndeksi()
	} else {
		// vastuu epäkelvoista lomaketunnisteista on queryVars()illa
		naytaLomake(action)
	}
}

function naytaLomake(lomakeRef) {
	if ( lomakeRef.otsikko ) {
		document.title = lomakeRef.otsikko.replace("<br>",", ")
		document.getElementById("otsikko").innerHTML = lomakeRef.otsikko
	} else {
		var viesti =  "Lomakkeen sisällön otsikko puuttuu tai on tyhjä, lomakkeen tunniste: " + lomakeRef.llid
		document.title = viesti
		document.getElementById("otsikko").innerHTML = viesti
	}
	// näytä lomakkeen täytön ohje
	document.getElementById("ohje").style.display="block"
	var koepaikka = document.getElementById("koepaikka")
	// tyhjennä lomakelista tai ed näytetty lomake
	koepaikka.innerHTML=""
	// luodaan kysymykset näytölle
	// alustetaan paikka vastauksille
	vastaukset = new Array()
	for (kv in lomakeRef.kysymykset) {
		naytaKysymys(lomakeRef.kysymykset[kv], koepaikka)
	}
}
			
function naytaKysymys(kysymysRef, minneDOM) {
	var kysymysDiv = document.createElement('div')
	kysymysDiv.className = "boksi"
	var innerHTML = "<p>" + kysymysRef.kysymys + "</p>" + formStub
	vastaukset.push(kysymysRef.vastaus)
	kysymysDiv.innerHTML = innerHTML
	minneDOM.appendChild(kysymysDiv)
}
			
function hashChange() {
	// BETTERME ehto taitaa olla tarpeeton
	if ( oldHash != window.location.hash ) { kont()	}
}
			
function naytaIndeksi() {
	// Tyhjennä lomakelistan paikka
	document.getElementById('koepaikka').innerHTML=""
	// aseta otsikot
	document.title = indexStubs.title
	document.getElementById("otsikko").innerHTML = indexStubs.otsikko
	// piilota ohje
	document.getElementById("ohje").style.display="none"
	// loopataan otsikot
	for (var i = 0; i < otsikot.length; i++) {
		// yhden otsikon käsittelevä looppi
		var obj = otsikot[i]
		var otsikkoInnerHTML = ""
		var otsikkoInnerHTMLend = ""
		for(var key in obj){
			switch (key) {
				case "otsikko":
					otsikkoInnerHTML = "<h2>" + obj[key] + "</h2><p><ul>"
					otsikkoInnerHTMLend = "</ul></p>"
					break
				case "lomakkeet":
					// listataan otsikon alle kuuluvat lomakkeet
					var lomakkeet = obj[key]
					for (var li in lomakkeet) {
						var lomake = lomakkeet[li]
						for(lk in lomake) {
							if (lk == "lomake") {
								otsikkoInnerHTML += "<li><a href='#" + lomake.llid + "'>" + lomake.lomake + "</a>"
							}
						}
					}
					break
				default:
					alert("Väärin nimettyä sisältöä, key: " + key)
					otsikkoInnerHTML += "<li>Virheellistä sisältöä: " + key
			}
		}
		// luodaan divi otsikolle, asetetaan sille sisältö ja laitetaan tulos näkyville
		var otsikkoDiv = document.createElement('div')
		otsikkoDiv.className = "ohje"
		otsikkoDiv.innerHTML = otsikkoInnerHTML + otsikkoInnerHTMLend
		document.getElementById('koepaikka').appendChild(otsikkoDiv)	
	}
}

function loytyykoLomake(id) {
	/* tutkii, löytyykö viitattu lomake
	Palauttaa:
	false, jos ei löydy
	lomakeviitteen, jos löytyy */
	for (var otsikko in otsikot) {
		var lomakkeet = otsikot[otsikko].lomakkeet
		for (var lomake in lomakkeet) {
			if ( id == lomakkeet[lomake].llid ) {
				return lomakkeet[lomake]
			}
		}
	}
	return false
}
		</script>
	</head>
	<body onLoad="kont()" onhashchange="hashChange()">
		<img class="alkukuva" src="omalogosi.jpg" />
		<noscript>Javascript on välttämätön näiden tehtävien kohdalla. Et voi käyttää
		näitä lomakkeita laitteella, joka ei tue javascriptiä tai jossa javascript on
		kytketty pois käytöstä.</noscript>
		<h1 id="otsikko"></h1>
		<div id="ohje" class="ohje">
			<p>
				Etsi vastaukset tehtäviin vaikka
				<a target="_blank" href="http://fi.wikipedia.org/">Wikipediasta</a> tai
				<a target="_blank" href="http://google.fi">Googlesta</a>.
				Oikea vastaus näkyy
				vihreänä, väärä punaisena. Kun kaikki kentät ovat vihreitä, tehtävä on
				suoritettu!
			</p>
		</div>
		<div id="koepaikka">
		</div>
		<img class="loppukuva" src="oma_logosi.jpg" />
		<div class="footer">
			<p>
				<!-- Muokkaa alle omat tietosi. Toivomme, että viittaat lomakkeeseemme. -->
				Tämä lomakkeisto käyttää <a href="http://s.iki.fi/krstl">KRSTL:ää eli Kirjastoreitin sähköistä tehtävälomake</a>tta.
				KRSTL annetaan käyttöön ja muokattavaksi, mutta mitään takuuta sen toimivuudesta tai hyödyllisyydestä emme anna. Emme myöskään vastaa mistään sen tai sen käytön aiheuttamista vahingoista.
				Tämä sähköinen lomake toteutettiin Oulun kaupunginkirjastossa keväällä 2013. Lomake antaa palautteen käyttäjälleen oikeasta tai väärästä vastauksesta. Vastauksia ei tallenneta minnekään. Lomakkeen teknisestä puolesta vastasi Sampo Lehtinen.
			</p>
			<p>
				Lisätietoja:<br />
				Iso titteli N. M.<br />
				Pienempi titteli A. O.<br />
			</p>
		</div>
	</body>
</html>
	
